<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">
    <link href="css/gwbuilder.css" rel="stylesheet">
  </head>
  <body>
    <section>
      <nav class="navbar navbar-expand-lg bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="https://gadawangi.com">
            <img src="images/logo-gw.png" />
            <span>Web Builder</span>
          </a>
          <div class="d-flex" role="search">
            <input hidden id ="IdRequestElement" class="form-control me-2" />
            <button class="btn btn-outline-success" onclick="PostDownload()">Download</button>
          </div>
        </div>
      </nav>
    </section>
    <section class="py-9 px-10 flex items-start w-full justify-end">
        <div class="GW_sidebar">
          <div onclick ="ShowProduct('Navbar')" class="GW_sidebar_item" style="padding-right: 0px;">
            <div class="flex w-full h-full items-center" style="padding-right: 20px;">
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24px" height="24px" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g><path style="opacity:0.501" fill="#000000" d="M 4.5,2.5 C 9.17853,2.33418 13.8452,2.50085 18.5,3C 19,3.5 19.5,4 20,4.5C 20.6667,9.16667 20.6667,13.8333 20,18.5C 19.5,19 19,19.5 18.5,20C 13.8333,20.6667 9.16667,20.6667 4.5,20C 4,19.5 3.5,19 3,18.5C 1.94555,12.8855 2.44555,7.5522 4.5,2.5 Z M 5.5,4.5 C 9.51383,4.33449 13.5138,4.50115 17.5,5C 17.9574,5.41395 18.2907,5.91395 18.5,6.5C 13.8333,7.83333 9.16667,7.83333 4.5,6.5C 4.86273,5.81654 5.19607,5.14987 5.5,4.5 Z M 4.5,9.5 C 9.16667,9.5 13.8333,9.5 18.5,9.5C 18.6641,12.1873 18.4974,14.854 18,17.5C 13.6667,18.8333 9.33333,18.8333 5,17.5C 4.50258,14.854 4.33591,12.1873 4.5,9.5 Z"/></g>
                </svg>
            </div>
          </div>
          <div onclick ="ShowProduct('Header')"  class="GW_sidebar_item" style="padding-right: 0px;">
            <div class="flex w-full h-full items-center" style="padding-right: 20px;">
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24px" height="24px" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g><path style="opacity:0.507" fill="#000000" d="M 4.5,2.5 C 9.17853,2.33418 13.8452,2.50085 18.5,3C 19,3.5 19.5,4 20,4.5C 20.6667,9.16667 20.6667,13.8333 20,18.5C 19.5,19 19,19.5 18.5,20C 13.8333,20.6667 9.16667,20.6667 4.5,20C 4,19.5 3.5,19 3,18.5C 1.94555,12.8855 2.44555,7.5522 4.5,2.5 Z M 5.5,4.5 C 9.51383,4.33449 13.5138,4.50115 17.5,5C 17.9574,5.41395 18.2907,5.91395 18.5,6.5C 13.8333,7.83333 9.16667,7.83333 4.5,6.5C 4.86273,5.81654 5.19607,5.14987 5.5,4.5 Z M 4.5,9.5 C 9.16667,9.5 13.8333,9.5 18.5,9.5C 18.5,10.8333 18.5,12.1667 18.5,13.5C 13.8333,13.5 9.16667,13.5 4.5,13.5C 4.5,12.1667 4.5,10.8333 4.5,9.5 Z M 4.5,15.5 C 9.21369,15.1734 13.8804,15.5067 18.5,16.5C 18.2907,17.086 17.9574,17.586 17.5,18C 13.5,18.6667 9.5,18.6667 5.5,18C 4.74756,17.3292 4.41423,16.4959 4.5,15.5 Z"/></g>
                </svg>
            </div>
          </div>
          <div onclick ="ShowProduct('Content')"  class="GW_sidebar_item" style="padding-right: 0px;">
            <div class="flex w-full h-full items-center" style="padding-right: 20px;">
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24px" height="24px" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g><path style="opacity:0.509" fill="#000000" d="M 4.5,2.5 C 9.17853,2.33418 13.8452,2.50085 18.5,3C 19,3.5 19.5,4 20,4.5C 20.6667,9.16667 20.6667,13.8333 20,18.5C 19.5,19 19,19.5 18.5,20C 13.8333,20.6667 9.16667,20.6667 4.5,20C 4,19.5 3.5,19 3,18.5C 1.94555,12.8855 2.44555,7.5522 4.5,2.5 Z M 5.5,4.5 C 9.51383,4.33449 13.5138,4.50115 17.5,5C 17.9574,5.41395 18.2907,5.91395 18.5,6.5C 13.8333,7.83333 9.16667,7.83333 4.5,6.5C 4.86273,5.81654 5.19607,5.14987 5.5,4.5 Z M 4.5,9.5 C 7.5,9.5 10.5,9.5 13.5,9.5C 13.5,12.5 13.5,15.5 13.5,18.5C 10.8127,18.6641 8.14603,18.4974 5.5,18C 4.55621,15.2809 4.22288,12.4475 4.5,9.5 Z M 15.5,9.5 C 16.5,9.5 17.5,9.5 18.5,9.5C 18.6641,12.1873 18.4974,14.854 18,17.5C 17.586,17.9574 17.086,18.2907 16.5,18.5C 15.5159,15.5719 15.1826,12.5719 15.5,9.5 Z"/></g>
                </svg>
            </div>
          </div>
          <div class="GW_sidebar_item" style="padding-right: 0px;">
            <div onclick ="ShowProduct('Footer')" class="flex w-full h-full items-center" style="padding-right: 20px;">
                <svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="24px" height="24px" style="shape-rendering:geometricPrecision; text-rendering:geometricPrecision; image-rendering:optimizeQuality; fill-rule:evenodd; clip-rule:evenodd" xmlns:xlink="http://www.w3.org/1999/xlink">
                  <g><path style="opacity:0.503" fill="#000000" d="M 4.5,2.5 C 9.17853,2.33418 13.8452,2.50085 18.5,3C 19,3.5 19.5,4 20,4.5C 20.6667,9.16667 20.6667,13.8333 20,18.5C 19.5,19 19,19.5 18.5,20C 13.8333,20.6667 9.16667,20.6667 4.5,20C 4,19.5 3.5,19 3,18.5C 1.94555,12.8855 2.44555,7.5522 4.5,2.5 Z M 5.5,4.5 C 9.51383,4.33449 13.5138,4.50115 17.5,5C 18.4438,7.71914 18.7771,10.5525 18.5,13.5C 13.8333,13.5 9.16667,13.5 4.5,13.5C 4.26414,10.3915 4.59748,7.39147 5.5,4.5 Z M 4.5,15.5 C 9.21369,15.1734 13.8804,15.5067 18.5,16.5C 18.2907,17.086 17.9574,17.586 17.5,18C 13.5,18.6667 9.5,18.6667 5.5,18C 4.74756,17.3292 4.41423,16.4959 4.5,15.5 Z"/></g>
                </svg>
            </div>
          </div>
        </div> <!-- navigation sidebar -->

        <div class="GW_products" id="IdProduct">
          <button onclick ="HideProduct()" class="btn btn-danger" style="position: absolute;top:8px;right: 10px;">
              <span>X</span>
          </button>
          <div class="GW_productsItem" id="idProductItem">
            <!-- tempat render product item-->
          </div>
        </div> <!-- Product Menu-->

        <div class="GW_content" style="min-height: auto;">
          <div class="GW_Content_win d-flex flex-column" id="IdContent">
            <!-- tempat render content -->
          </div>
        </div> <!-- Content -->

    </section>
    <script src="js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script lang="javascript">
        /*AJAX*/
        function createRequestObject() {
            var ro;
            var browser = navigator.appName;
            if(browser == "Microsoft Internet Explorer"){
                ro = new ActiveXObject("Microsoft.XMLHTTP");
            }else{
                ro = new XMLHttpRequest();
            }
            return ro;
        }

        var http = createRequestObject();
        function sendRequest(method, urls, jobs, data) {
            var rootUrl = 'http://localhost:8080/index.php/webbuilder/';
            //var rootUrl = 'http://localhost/backend_webbuilder/index.php/';
            http.open(method, rootUrl+urls);
            http.setRequestHeader("Cache-Control", "no-cache");
            http.onloadstart = function() {
              document.getElementById('idProductItem').appendChild(ShowLoading());
            }
            http.onload = function(){
                handleResponse(jobs);
            }
            http.send(data);
        }

        function handleResponse(jobs) {
            if(http.readyState == 4 && http.status == 200){
                var response = http.responseText;
                if(jobs == 'draw-elements')
                  DrawElements(response);
                else if(jobs == 'download-page')
                  DownloadPage(response);
            }
        }

        /* Handle UI */
        function ShowProduct(KategoriProduct)
        {
          var product = document.getElementById("IdProduct");
          product.style.display = "block";
          sendRequest('get', 'elements/'+KategoriProduct.toLowerCase(), 'draw-elements', null);
        }
        function HideProduct()
        {
          var product = document.getElementById("IdProduct");
          product.style.display = "none";
        }

        function ShowLoading() 
        {
          var divElement = document.createElement("div");
          divElement.style.textAlign = "center";
          divElement.style.padding = "70px";
          divElement.style.height = "100%";

          var imgElement = document.createElement("img");
          imgElement.src = "images/loading.gif";
        
          divElement.appendChild(imgElement);

          return divElement;
        }

        function DrawElements(response)
        {
          var dataJson = JSON.parse(response);
          console.log(response);
          document.getElementById('idProductItem').innerHTML = "";

          for(i = 0; i < dataJson.length; i++){
            var divItem = document.createElement("div");
            divItem.className = "GW_productsItem_item";

            var imgItem = document.createElement("img");
            imgItem.src = dataJson[i]['image'];
            divItem.appendChild(imgItem);

            var aItem = document.createElement("a");
            aItem.href = "#";
            //aItem.style.opacity = "1";
            aItem.addEventListener("click", AddElement.bind(event, dataJson[i]['id']));

            var svgItem = '<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">';
            svgItem += '<circle cx="18" cy="18" r="18" fill="#FF5525"></circle>';
            svgItem += '<path fill-rule="evenodd" clip-rule="evenodd" d="M18 11.25C18.1989 11.25 18.3897 11.329 18.5303 11.4697C18.671 11.6103 18.75 11.8011 18.75 12V18C18.75 18.1989 18.671 18.3897 18.5303 18.5303C18.3897 18.671 18.1989 18.75 18 18.75H12C11.8011 18.75 11.6103 18.671 11.4697 18.5303C11.329 18.3897 11.25 18.1989 11.25 18C11.25 17.8011 11.329 17.6103 11.4697 17.4697C11.6103 17.329 11.8011 17.25 12 17.25H17.25V12C17.25 11.8011 17.329 11.6103 17.4697 11.4697C17.6103 11.329 17.8011 11.25 18 11.25Z" fill="white">';
            svgItem += '</path>';
            svgItem += '<path fill-rule="evenodd" clip-rule="evenodd" d="M17.25 18C17.25 17.8011 17.329 17.6103 17.4697 17.4697C17.6103 17.329 17.8011 17.25 18 17.25H24C24.1989 17.25 24.3897 17.329 24.5303 17.4697C24.671 17.6103 24.75 17.8011 24.75 18C24.75 18.1989 24.671 18.3897 24.5303 18.5303C24.3897 18.671 24.1989 18.75 24 18.75H18.75V24C18.75 24.1989 18.671 24.3897 18.5303 24.5303C18.3897 24.671 18.1989 24.75 18 24.75C17.8011 24.75 17.6103 24.671 17.4697 24.5303C17.329 24.3897 17.25 24.1989 17.25 24V18Z" fill="white">';
            svgItem += '</path>';
            svgItem += '</svg>';
            aItem.innerHTML = svgItem;
            divItem.appendChild(aItem);

            var divHtml = document.createElement("div");
            divHtml.id = "IdProductItem-"+dataJson[i]['id'];
            divHtml.hidden = true;
            divHtml.innerHTML = StringToHTML(dataJson[i]['html']);
            divItem.appendChild(divHtml);

            document.getElementById('idProductItem').appendChild(divItem);
          }
        }

        function AddElement(idItem)
        {
          var divContent = document.createElement("div");
          divContent.id = "IdElement-"+idItem;
          divContent.className = "GW_content_fill";

          var divFill = document.createElement("div");
          divFill.innerHTML = document.getElementById('IdProductItem-'+idItem).innerHTML;
          divContent.appendChild(divFill);

          var imgRemove = document.createElement("img");
          imgRemove.src = "images/trash.svg";
          imgRemove.className = "GW_content_delete";
          imgRemove.addEventListener("click", RemoveElement.bind(event, idItem));
          divContent.appendChild(imgRemove);

          document.getElementById('IdContent').appendChild(divContent);

          var reqElement = document.getElementById('IdRequestElement').value;
          var obj_json;
          if(reqElement == '') {
            obj_json = [];
            obj_json.push({elemen : idItem, user : ''});
            document.getElementById('IdRequestElement').value = JSON.stringify(obj_json);
          } else {
            obj_json = JSON.parse(reqElement);
            obj_json.push({elemen : idItem, user : ''});
            document.getElementById('IdRequestElement').value = JSON.stringify(obj_json);
          }

          HideProduct();
        }

        function RemoveElement(idItem)
        {
          var reqElement = document.getElementById('IdRequestElement').value;
          var obj_json;
          obj_json = JSON.parse(reqElement);
          const idxObj = obj_json.findIndex(object => {
            return object.elemen === idItem;
          });

          obj_json.splice(idxObj, 1);
          var postData = JSON.stringify(obj_json);
          if(postData == '[]')
            postData = '';
          document.getElementById('IdRequestElement').value = postData;

          document.getElementById("IdElement-"+idItem).remove();
        }

        function PostDownload()
        {
          var data = document.getElementById('IdRequestElement').value;
          if(data == '')
            alert("Tidak ada element HTML yang dipilih!");
          else
            sendRequest('post', 'download', 'download-page', data);
        }

        function DownloadPage(response){
            var blob = new Blob([response]);
            var link = document.createElement('a');
            link.href = window.URL.createObjectURL(blob);
            link.download = "index.html";
            link.click();
        }
        /* Helper */
        function StringToHTML(str)
        {
          let txt = new DOMParser().parseFromString(str, "text/html");
          return txt.documentElement.textContent;
        }
    </script>
  </body>
</html> 
